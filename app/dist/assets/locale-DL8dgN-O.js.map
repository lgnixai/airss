{"version":3,"file":"locale-DL8dgN-O.js","sources":["../../../esm/models/locale.js","../../../esm/services/locale.js"],"sourcesContent":["var LocalizationEvent = /* @__PURE__ */ ((LocalizationEvent2) => {\n  LocalizationEvent2[\"onChange\"] = \"localization.onChange\";\n  return LocalizationEvent2;\n})(LocalizationEvent || {});\nclass LocaleModel {\n  constructor(data = [], current) {\n    this.data = data;\n    this.current = current;\n  }\n}\nexport {\n  LocaleModel,\n  LocalizationEvent\n};\n","import { isUndefined } from \"lodash-es\";\nimport { LOCALE_STORE_KEY } from \"../const\";\nimport { BaseService } from \"../glue\";\nimport { LocaleModel, LocalizationEvent } from \"../models/locale\";\nimport { arraylize, getPrevOrNext, searchById } from \"../utils\";\nimport { setLocale } from \"../utils/storage\";\nclass LocaleService extends BaseService {\n  static LOCALIZE_REPLACED_WORD = \"${i}\";\n  state;\n  constructor() {\n    super(\"locale\");\n    this.state = new LocaleModel();\n  }\n  getAll() {\n    return this.getState().data;\n  }\n  get(id) {\n    if (isUndefined(id))\n      return;\n    return this.getState().data.find(searchById(id));\n  }\n  getCurrent() {\n    return this.getState().current;\n  }\n  getCurrentLocale() {\n    return this.get(this.getCurrent());\n  }\n  removeLocale(id) {\n    this.dispatch((draft) => {\n      const idx = draft.data.findIndex(searchById(id));\n      if (idx === -1)\n        return;\n      const next = getPrevOrNext(draft.data, idx)?.id;\n      if (isUndefined(next))\n        return;\n      draft.data.splice(idx, 1);\n      draft.current = next;\n    });\n  }\n  setCurrent(id) {\n    const prev = this.getCurrent();\n    this.dispatch((draft) => {\n      draft.current = id;\n    });\n    if (prev !== this.getCurrent()) {\n      this.emit(LocalizationEvent.onChange, prev, this.getCurrent());\n      setLocale(LOCALE_STORE_KEY, id.toString());\n    }\n  }\n  add(locale) {\n    this.dispatch((draft) => {\n      draft.data.push(...arraylize(locale));\n    });\n  }\n  localize = (sourceKey, defaultValue = \"\", ...args) => {\n    const locale = this.getCurrentLocale();\n    if (!locale)\n      return defaultValue;\n    let result = locale.source[sourceKey];\n    if (args.length) {\n      args.forEach((replacedVal) => {\n        result = result?.replace(LocaleService.LOCALIZE_REPLACED_WORD, replacedVal);\n      });\n    }\n    return result || defaultValue;\n  };\n  reset() {\n    this.state = new LocaleModel();\n  }\n  // ===================== Subscriptions =====================\n  onChange(callback) {\n    this.subscribe(LocalizationEvent.onChange, callback);\n  }\n}\nexport {\n  LocaleService\n};\n"],"names":["LocalizationEvent","LocalizationEvent2","LocaleModel","data","current","LocaleService","BaseService","id","isUndefined","searchById","draft","idx","next","getPrevOrNext","prev","setLocale","LOCALE_STORE_KEY","locale","arraylize","sourceKey","defaultValue","args","result","replacedVal","callback"],"mappings":"uOAAA,IAAIA,GAAsCC,IACxCA,EAAmB,SAAc,wBAC1BA,IACND,GAAqB,CAAA,CAAE,EAC1B,MAAME,CAAY,CAChB,YAAYC,EAAO,CAAA,EAAIC,EAAS,CAC9B,KAAK,KAAOD,EACZ,KAAK,QAAUC,CACjB,CACF,CCHA,MAAMC,UAAsBC,CAAY,CACtC,OAAO,uBAAyB,OAChC,MACA,aAAc,CACZ,MAAM,QAAQ,EACd,KAAK,MAAQ,IAAIJ,CACnB,CACA,QAAS,CACP,OAAO,KAAK,SAAQ,EAAG,IACzB,CACA,IAAIK,EAAI,CACN,GAAI,CAAAC,EAAYD,CAAE,EAElB,OAAO,KAAK,WAAW,KAAK,KAAKE,EAAWF,CAAE,CAAC,CACjD,CACA,YAAa,CACX,OAAO,KAAK,SAAQ,EAAG,OACzB,CACA,kBAAmB,CACjB,OAAO,KAAK,IAAI,KAAK,WAAU,CAAE,CACnC,CACA,aAAaA,EAAI,CACf,KAAK,SAAUG,GAAU,CACvB,MAAMC,EAAMD,EAAM,KAAK,UAAUD,EAAWF,CAAE,CAAC,EAC/C,GAAII,IAAQ,GACV,OACF,MAAMC,EAAOC,EAAcH,EAAM,KAAMC,CAAG,GAAG,GACzCH,EAAYI,CAAI,IAEpBF,EAAM,KAAK,OAAOC,EAAK,CAAC,EACxBD,EAAM,QAAUE,EAClB,CAAC,CACH,CACA,WAAWL,EAAI,CACb,MAAMO,EAAO,KAAK,WAAU,EAC5B,KAAK,SAAUJ,GAAU,CACvBA,EAAM,QAAUH,CAClB,CAAC,EACGO,IAAS,KAAK,eAChB,KAAK,KAAKd,EAAkB,SAAUc,EAAM,KAAK,YAAY,EAC7DC,EAAUC,EAAkBT,EAAG,UAAU,EAE7C,CACA,IAAIU,EAAQ,CACV,KAAK,SAAUP,GAAU,CACvBA,EAAM,KAAK,KAAK,GAAGQ,EAAUD,CAAM,CAAC,CACtC,CAAC,CACH,CACA,SAAW,CAACE,EAAWC,EAAe,MAAOC,IAAS,CACpD,MAAMJ,EAAS,KAAK,iBAAgB,EACpC,GAAI,CAACA,EACH,OAAOG,EACT,IAAIE,EAASL,EAAO,OAAOE,CAAS,EACpC,OAAIE,EAAK,QACPA,EAAK,QAASE,GAAgB,CAC5BD,EAASA,GAAQ,QAAQjB,EAAc,uBAAwBkB,CAAW,CAC5E,CAAC,EAEID,GAAUF,CACnB,EACA,OAAQ,CACN,KAAK,MAAQ,IAAIlB,CACnB,CAEA,SAASsB,EAAU,CACjB,KAAK,UAAUxB,EAAkB,SAAUwB,CAAQ,CACrD,CACF"}