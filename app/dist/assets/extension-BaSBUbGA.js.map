{"version":3,"file":"extension-BaSBUbGA.js","sources":["../../../esm/models/extension.js","../../../esm/services/extension.js"],"sourcesContent":["class ExtensionModel {\n  constructor(data = []) {\n    this.data = data;\n  }\n}\nexport {\n  ExtensionModel\n};\n","var __defProp = Object.defineProperty;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __decorateClass = (decorators, target, key, kind) => {\n  var result = kind > 1 ? void 0 : kind ? __getOwnPropDesc(target, key) : target;\n  for (var i = decorators.length - 1, decorator; i >= 0; i--)\n    if (decorator = decorators[i])\n      result = (kind ? decorator(target, key, result) : decorator(result)) || result;\n  if (kind && result)\n    __defProp(target, key, result);\n  return result;\n};\nvar __decorateParam = (index, decorator) => (target, key) => decorator(target, key, index);\nimport { BaseService } from \"../glue\";\nimport { ExtensionModel } from \"../models/extension\";\nimport {\n  IContributeType\n} from \"../types\";\nimport { arraylize, searchById } from \"../utils\";\nimport { inject, injectable } from \"tsyringe\";\nlet ExtensionService = class extends BaseService {\n  constructor(locale, builtin, contextMenu, auxiliaryBar, layout, statusBar, menuBar, activityBar, sidebar, explorer, folderTree, panel, output, editor, colorTheme, action, editorTree, notification, search, settings, monaco, module) {\n    super(\"extension\");\n    this.locale = locale;\n    this.builtin = builtin;\n    this.contextMenu = contextMenu;\n    this.auxiliaryBar = auxiliaryBar;\n    this.layout = layout;\n    this.statusBar = statusBar;\n    this.menuBar = menuBar;\n    this.activityBar = activityBar;\n    this.sidebar = sidebar;\n    this.explorer = explorer;\n    this.folderTree = folderTree;\n    this.panel = panel;\n    this.output = output;\n    this.editor = editor;\n    this.colorTheme = colorTheme;\n    this.action = action;\n    this.editorTree = editorTree;\n    this.notification = notification;\n    this.search = search;\n    this.settings = settings;\n    this.monaco = monaco;\n    this.module = module;\n    this.state = new ExtensionModel();\n  }\n  state;\n  _predicate = () => true;\n  getContext = () => {\n    return {\n      locale: this.locale,\n      builtin: this.builtin,\n      contextMenu: this.contextMenu,\n      auxiliaryBar: this.auxiliaryBar,\n      layout: this.layout,\n      statusBar: this.statusBar,\n      menuBar: this.menuBar,\n      activityBar: this.activityBar,\n      sidebar: this.sidebar,\n      explorer: this.explorer,\n      folderTree: this.folderTree,\n      panel: this.panel,\n      output: this.output,\n      editor: this.editor,\n      colorTheme: this.colorTheme,\n      action: this.action,\n      editorTree: this.editorTree,\n      notification: this.notification,\n      search: this.search,\n      settings: this.settings\n    };\n  };\n  isExtension(extension) {\n    if (!extension)\n      return false;\n    return typeof extension === \"object\" && [\"activate\", \"id\", \"name\"].every((property) => property in extension);\n  }\n  get(id) {\n    return this.getAll().find(searchById(id));\n  }\n  getAll() {\n    return this.getState().data;\n  }\n  inactive(predicate) {\n    this._predicate = predicate;\n  }\n  add(extensions) {\n    this.dispatch((draft) => {\n      draft.data.push(...arraylize(extensions));\n    });\n  }\n  load(onigurumPath) {\n    const extensions = this.getAll();\n    if (!Array.isArray(extensions))\n      return;\n    extensions.filter(this._predicate).forEach((extension) => {\n      if (!this.isExtension(extension))\n        return;\n      if (extension.contributes) {\n        this.loadContributes(extension.contributes, onigurumPath);\n      }\n    });\n  }\n  activate() {\n    const extensions = this.getAll();\n    if (!Array.isArray(extensions))\n      return;\n    const ctx = this.getContext();\n    extensions.filter(this._predicate).forEach((extension) => {\n      if (!this.isExtension(extension))\n        return;\n      extension.activate(ctx, this.monaco);\n    });\n  }\n  loadContributes(contributes, onigurumPath) {\n    const contributeKeys = Object.keys(contributes);\n    contributeKeys.forEach((type) => {\n      switch (type) {\n        case IContributeType.Themes: {\n          const themes = contributes[type];\n          if (!Array.isArray(themes))\n            return;\n          this.colorTheme.add(themes);\n          break;\n        }\n        case IContributeType.Languages: {\n          const locales = contributes[type];\n          if (!Array.isArray(locales))\n            return;\n          this.locale.add(locales);\n          break;\n        }\n        case IContributeType.Commands: {\n          const commands = contributes[type];\n          if (!Array.isArray(commands))\n            return;\n          commands.forEach((command) => this.action.registerAction(command));\n          break;\n        }\n        case IContributeType.Modules: {\n          const modules = contributes[type];\n          if (!modules)\n            return;\n          Object.keys(modules).forEach((key) => {\n            this.module.update(key, modules[key]);\n          });\n          break;\n        }\n        case IContributeType.Grammar: {\n          const grammars = contributes[type];\n          this.colorTheme._activeGrammar(grammars, onigurumPath);\n          break;\n        }\n        default:\n          break;\n      }\n    });\n  }\n  dispose(extensionId) {\n    const ctx = this.getContext();\n    const extension = this.get(extensionId);\n    if (extension) {\n      extension.dispose?.(ctx);\n      this.dispatch((draft) => {\n        const idx = draft.data.findIndex(searchById(extensionId));\n        if (idx === -1)\n          return;\n        draft.data.splice(idx, 1);\n      });\n    }\n  }\n  disposeAll() {\n    const extensions = this.getAll();\n    extensions.forEach((ext) => {\n      const ctx = this.getContext();\n      ext.dispose?.(ctx);\n    });\n    this.reset();\n  }\n  reset() {\n    this.setState(new ExtensionModel());\n  }\n};\nExtensionService = __decorateClass([\n  injectable(),\n  __decorateParam(0, inject(\"locale\")),\n  __decorateParam(1, inject(\"builtin\")),\n  __decorateParam(2, inject(\"contextMenu\")),\n  __decorateParam(3, inject(\"auxiliaryBar\")),\n  __decorateParam(4, inject(\"layout\")),\n  __decorateParam(5, inject(\"statusBar\")),\n  __decorateParam(6, inject(\"menuBar\")),\n  __decorateParam(7, inject(\"activityBar\")),\n  __decorateParam(8, inject(\"sidebar\")),\n  __decorateParam(9, inject(\"explorer\")),\n  __decorateParam(10, inject(\"folderTree\")),\n  __decorateParam(11, inject(\"panel\")),\n  __decorateParam(12, inject(\"output\")),\n  __decorateParam(13, inject(\"editor\")),\n  __decorateParam(14, inject(\"colorTheme\")),\n  __decorateParam(15, inject(\"action\")),\n  __decorateParam(16, inject(\"editorTree\")),\n  __decorateParam(17, inject(\"notification\")),\n  __decorateParam(18, inject(\"search\")),\n  __decorateParam(19, inject(\"settings\")),\n  __decorateParam(20, inject(\"monaco\")),\n  __decorateParam(21, inject(\"module\"))\n], ExtensionService);\nexport {\n  ExtensionService\n};\n"],"names":["ExtensionModel","data","__getOwnPropDesc","__decorateClass","decorators","target","key","kind","result","i","decorator","__decorateParam","index","ExtensionService","BaseService","locale","builtin","contextMenu","auxiliaryBar","layout","statusBar","menuBar","activityBar","sidebar","explorer","folderTree","panel","output","editor","colorTheme","action","editorTree","notification","search","settings","monaco","module","extension","property","id","searchById","predicate","extensions","draft","arraylize","onigurumPath","ctx","contributes","type","IContributeType","themes","locales","commands","command","modules","grammars","extensionId","idx","ext","injectable","inject"],"mappings":"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"}