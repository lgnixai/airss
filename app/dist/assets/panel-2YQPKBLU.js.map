{"version":3,"file":"panel-2YQPKBLU.js","sources":["../../../esm/services/panel.js"],"sourcesContent":["import { BaseService } from \"../glue\";\nimport { PanelEvent, PanelModel } from \"../models/panel\";\nimport { arraylize, getPrevOrNext, searchById } from \"../utils\";\nclass PanelService extends BaseService {\n  state;\n  constructor() {\n    super(\"panel\");\n    this.state = new PanelModel();\n  }\n  get(id) {\n    return this.getAll().find(searchById(id));\n  }\n  getAll() {\n    return this.getState().data;\n  }\n  getToolbar(id) {\n    return this.getState().toolbar.find(searchById(id));\n  }\n  getPanelToolbar(panelId, toolbarId) {\n    return this.get(panelId)?.toolbar?.find(searchById(toolbarId));\n  }\n  add(data) {\n    this.dispatch((draft) => {\n      draft.data.push(...arraylize(data));\n    });\n  }\n  update(item, predict) {\n    this.dispatch((draft) => {\n      const target = draft.data.find(searchById(typeof item === \"object\" ? item.id : item));\n      if (!target)\n        return;\n      Object.assign(target, typeof item === \"object\" ? item : predict?.(target));\n    });\n  }\n  remove(id) {\n    this.dispatch((draft) => {\n      const idx = draft.data.findIndex(searchById(id));\n      if (idx === -1)\n        return;\n      if (draft.current === id) {\n        draft.current = getPrevOrNext(draft.data, idx)?.id;\n      }\n      draft.data.splice(idx, 1);\n    });\n  }\n  setCurrent(id) {\n    this.dispatch((draft) => {\n      draft.current = id;\n    });\n  }\n  open(data) {\n    const panel = this.get(data.id);\n    if (panel) {\n      this.setCurrent(panel.id);\n    } else {\n      this.add(data);\n      this.setCurrent(data.id);\n    }\n  }\n  addToolbar(toolbar) {\n    this.dispatch((draft) => {\n      draft.toolbar.push(...arraylize(toolbar));\n    });\n  }\n  updateToolbar(item, predict) {\n    this.dispatch((draft) => {\n      const target = draft.toolbar.find(\n        searchById(typeof item === \"object\" ? item.id : item)\n      );\n      if (!target)\n        return;\n      Object.assign(target, typeof item === \"object\" ? item : predict?.(target));\n    });\n  }\n  toggle(id) {\n    this.update(id, (prev) => ({ hidden: !prev.hidden }));\n  }\n  reset() {\n    this.setState(new PanelModel());\n  }\n  // ===================== Subscriptions =====================\n  onChange(callback) {\n    this.subscribe(PanelEvent.onChange, callback);\n  }\n  onToolbarClick(callback) {\n    this.subscribe(PanelEvent.onToolbarClick, callback);\n  }\n  onClose(callback) {\n    this.subscribe(PanelEvent.onClose, callback);\n  }\n  onContextMenu(callback) {\n    this.subscribe(PanelEvent.onContextMenu, callback);\n  }\n}\nexport {\n  PanelService\n};\n"],"names":["PanelService","BaseService","PanelModel","id","searchById","panelId","toolbarId","data","draft","arraylize","item","predict","target","idx","getPrevOrNext","panel","toolbar","prev","callback","PanelEvent"],"mappings":"2LAGA,MAAMA,UAAqBC,CAAY,CACrC,MACA,aAAc,CACZ,MAAM,OAAO,EACb,KAAK,MAAQ,IAAIC,CACnB,CACA,IAAIC,EAAI,CACN,OAAO,KAAK,OAAM,EAAG,KAAKC,EAAWD,CAAE,CAAC,CAC1C,CACA,QAAS,CACP,OAAO,KAAK,SAAQ,EAAG,IACzB,CACA,WAAWA,EAAI,CACb,OAAO,KAAK,WAAW,QAAQ,KAAKC,EAAWD,CAAE,CAAC,CACpD,CACA,gBAAgBE,EAASC,EAAW,CAClC,OAAO,KAAK,IAAID,CAAO,GAAG,SAAS,KAAKD,EAAWE,CAAS,CAAC,CAC/D,CACA,IAAIC,EAAM,CACR,KAAK,SAAUC,GAAU,CACvBA,EAAM,KAAK,KAAK,GAAGC,EAAUF,CAAI,CAAC,CACpC,CAAC,CACH,CACA,OAAOG,EAAMC,EAAS,CACpB,KAAK,SAAUH,GAAU,CACvB,MAAMI,EAASJ,EAAM,KAAK,KAAKJ,EAAW,OAAOM,GAAS,SAAWA,EAAK,GAAKA,CAAI,CAAC,EAC/EE,GAEL,OAAO,OAAOA,EAAQ,OAAOF,GAAS,SAAWA,EAAOC,IAAUC,CAAM,CAAC,CAC3E,CAAC,CACH,CACA,OAAOT,EAAI,CACT,KAAK,SAAUK,GAAU,CACvB,MAAMK,EAAML,EAAM,KAAK,UAAUJ,EAAWD,CAAE,CAAC,EAC3CU,IAAQ,KAERL,EAAM,UAAYL,IACpBK,EAAM,QAAUM,EAAcN,EAAM,KAAMK,CAAG,GAAG,IAElDL,EAAM,KAAK,OAAOK,EAAK,CAAC,EAC1B,CAAC,CACH,CACA,WAAWV,EAAI,CACb,KAAK,SAAUK,GAAU,CACvBA,EAAM,QAAUL,CAClB,CAAC,CACH,CACA,KAAKI,EAAM,CACT,MAAMQ,EAAQ,KAAK,IAAIR,EAAK,EAAE,EAC1BQ,EACF,KAAK,WAAWA,EAAM,EAAE,GAExB,KAAK,IAAIR,CAAI,EACb,KAAK,WAAWA,EAAK,EAAE,EAE3B,CACA,WAAWS,EAAS,CAClB,KAAK,SAAUR,GAAU,CACvBA,EAAM,QAAQ,KAAK,GAAGC,EAAUO,CAAO,CAAC,CAC1C,CAAC,CACH,CACA,cAAcN,EAAMC,EAAS,CAC3B,KAAK,SAAUH,GAAU,CACvB,MAAMI,EAASJ,EAAM,QAAQ,KAC3BJ,EAAW,OAAOM,GAAS,SAAWA,EAAK,GAAKA,CAAI,CAC5D,EACWE,GAEL,OAAO,OAAOA,EAAQ,OAAOF,GAAS,SAAWA,EAAOC,IAAUC,CAAM,CAAC,CAC3E,CAAC,CACH,CACA,OAAOT,EAAI,CACT,KAAK,OAAOA,EAAKc,IAAU,CAAE,OAAQ,CAACA,EAAK,MAAM,EAAG,CACtD,CACA,OAAQ,CACN,KAAK,SAAS,IAAIf,CAAY,CAChC,CAEA,SAASgB,EAAU,CACjB,KAAK,UAAUC,EAAW,SAAUD,CAAQ,CAC9C,CACA,eAAeA,EAAU,CACvB,KAAK,UAAUC,EAAW,eAAgBD,CAAQ,CACpD,CACA,QAAQA,EAAU,CAChB,KAAK,UAAUC,EAAW,QAASD,CAAQ,CAC7C,CACA,cAAcA,EAAU,CACtB,KAAK,UAAUC,EAAW,cAAeD,CAAQ,CACnD,CACF"}