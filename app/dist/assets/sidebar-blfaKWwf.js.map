{"version":3,"file":"sidebar-blfaKWwf.js","sources":["../../../esm/services/sidebar.js"],"sourcesContent":["import { isUndefined } from \"lodash-es\";\nimport { BaseService } from \"../glue\";\nimport { SidebarEvent, SidebarModel } from \"../models/sidebar\";\nimport { arraylize, getPrevOrNext, searchById } from \"../utils\";\nclass SidebarService extends BaseService {\n  state;\n  constructor() {\n    super(\"sidebar\");\n    this.state = new SidebarModel();\n  }\n  get(id) {\n    if (isUndefined(id))\n      return;\n    return this.getAll().find(searchById(id));\n  }\n  getAll() {\n    return this.getState().data;\n  }\n  getCurrent() {\n    return this.getState().current;\n  }\n  getCurrentPane() {\n    return this.get(this.getCurrent());\n  }\n  getToolbar(paneId, toolbarId) {\n    return this.get(paneId)?.toolbar?.find(searchById(toolbarId));\n  }\n  add(data) {\n    this.dispatch((draft) => {\n      draft.data.push(...arraylize(data));\n    });\n  }\n  addToolbar(paneId, toolbars) {\n    this.dispatch((draft) => {\n      const target = draft.data.find(searchById(paneId));\n      if (!target)\n        return;\n      target.toolbar ??= [];\n      target.toolbar.push(...arraylize(toolbars));\n    });\n  }\n  update(item, predict) {\n    this.dispatch((draft) => {\n      const target = draft.data.find(searchById(typeof item === \"object\" ? item.id : item));\n      if (!target)\n        return;\n      Object.assign(target, typeof item === \"object\" ? item : predict?.(target));\n    });\n  }\n  updateToolbar(paneId, item, predict) {\n    this.dispatch((draft) => {\n      const target = draft.data.find(searchById(paneId));\n      const targetToolbar = target?.toolbar?.find(searchById(typeof item === \"object\" ? item.id : item));\n      if (!targetToolbar)\n        return;\n      Object.assign(targetToolbar, typeof item === \"object\" ? item : predict?.(targetToolbar));\n    });\n  }\n  replaceToolbar(paneId, replacedId, toolbar) {\n    this.dispatch((draft) => {\n      const target = draft.data.find(searchById(paneId));\n      const targetToolbar = target?.toolbar?.find(searchById(replacedId));\n      if (!targetToolbar)\n        return;\n      Object.assign(targetToolbar, toolbar);\n    });\n  }\n  remove(id) {\n    this.dispatch((draft) => {\n      const idx = draft.data.findIndex(searchById(id));\n      if (idx === -1)\n        return;\n      if (draft.current === id) {\n        draft.current = getPrevOrNext(draft.data, idx)?.id;\n      }\n      draft.data.splice(idx, 1);\n    });\n  }\n  setCurrent(id) {\n    this.dispatch((draft) => {\n      draft.current = id;\n    });\n  }\n  setLoading(loading) {\n    this.dispatch((draft) => {\n      draft.loading = typeof loading === \"function\" ? loading(draft.loading) : loading;\n    });\n  }\n  reset() {\n    this.setState(new SidebarModel());\n  }\n  // ===================== Subscriptions =====================\n  onToolbarClick = (callback) => {\n    this.subscribe(SidebarEvent.onToolbarClick, callback);\n  };\n  onContextMenu(callback) {\n    this.subscribe(SidebarEvent.onContextMenu, callback);\n  }\n}\nexport {\n  SidebarService\n};\n"],"names":["SidebarService","BaseService","SidebarModel","id","isUndefined","searchById","paneId","toolbarId","data","draft","arraylize","toolbars","target","item","predict","targetToolbar","replacedId","toolbar","idx","getPrevOrNext","loading","callback","SidebarEvent"],"mappings":"qQAIA,MAAMA,UAAuBC,CAAY,CACvC,MACA,aAAc,CACZ,MAAM,SAAS,EACf,KAAK,MAAQ,IAAIC,CACnB,CACA,IAAIC,EAAI,CACN,GAAI,CAAAC,EAAYD,CAAE,EAElB,OAAO,KAAK,OAAM,EAAG,KAAKE,EAAWF,CAAE,CAAC,CAC1C,CACA,QAAS,CACP,OAAO,KAAK,SAAQ,EAAG,IACzB,CACA,YAAa,CACX,OAAO,KAAK,SAAQ,EAAG,OACzB,CACA,gBAAiB,CACf,OAAO,KAAK,IAAI,KAAK,WAAU,CAAE,CACnC,CACA,WAAWG,EAAQC,EAAW,CAC5B,OAAO,KAAK,IAAID,CAAM,GAAG,SAAS,KAAKD,EAAWE,CAAS,CAAC,CAC9D,CACA,IAAIC,EAAM,CACR,KAAK,SAAUC,GAAU,CACvBA,EAAM,KAAK,KAAK,GAAGC,EAAUF,CAAI,CAAC,CACpC,CAAC,CACH,CACA,WAAWF,EAAQK,EAAU,CAC3B,KAAK,SAAUF,GAAU,CACvB,MAAMG,EAASH,EAAM,KAAK,KAAKJ,EAAWC,CAAM,CAAC,EAC5CM,IAELA,EAAO,UAAY,CAAA,EACnBA,EAAO,QAAQ,KAAK,GAAGF,EAAUC,CAAQ,CAAC,EAC5C,CAAC,CACH,CACA,OAAOE,EAAMC,EAAS,CACpB,KAAK,SAAUL,GAAU,CACvB,MAAMG,EAASH,EAAM,KAAK,KAAKJ,EAAW,OAAOQ,GAAS,SAAWA,EAAK,GAAKA,CAAI,CAAC,EAC/ED,GAEL,OAAO,OAAOA,EAAQ,OAAOC,GAAS,SAAWA,EAAOC,IAAUF,CAAM,CAAC,CAC3E,CAAC,CACH,CACA,cAAcN,EAAQO,EAAMC,EAAS,CACnC,KAAK,SAAUL,GAAU,CAEvB,MAAMM,EADSN,EAAM,KAAK,KAAKJ,EAAWC,CAAM,CAAC,GACnB,SAAS,KAAKD,EAAW,OAAOQ,GAAS,SAAWA,EAAK,GAAKA,CAAI,CAAC,EAC5FE,GAEL,OAAO,OAAOA,EAAe,OAAOF,GAAS,SAAWA,EAAOC,IAAUC,CAAa,CAAC,CACzF,CAAC,CACH,CACA,eAAeT,EAAQU,EAAYC,EAAS,CAC1C,KAAK,SAAUR,GAAU,CAEvB,MAAMM,EADSN,EAAM,KAAK,KAAKJ,EAAWC,CAAM,CAAC,GACnB,SAAS,KAAKD,EAAWW,CAAU,CAAC,EAC7DD,GAEL,OAAO,OAAOA,EAAeE,CAAO,CACtC,CAAC,CACH,CACA,OAAOd,EAAI,CACT,KAAK,SAAUM,GAAU,CACvB,MAAMS,EAAMT,EAAM,KAAK,UAAUJ,EAAWF,CAAE,CAAC,EAC3Ce,IAAQ,KAERT,EAAM,UAAYN,IACpBM,EAAM,QAAUU,EAAcV,EAAM,KAAMS,CAAG,GAAG,IAElDT,EAAM,KAAK,OAAOS,EAAK,CAAC,EAC1B,CAAC,CACH,CACA,WAAWf,EAAI,CACb,KAAK,SAAUM,GAAU,CACvBA,EAAM,QAAUN,CAClB,CAAC,CACH,CACA,WAAWiB,EAAS,CAClB,KAAK,SAAUX,GAAU,CACvBA,EAAM,QAAU,OAAOW,GAAY,WAAaA,EAAQX,EAAM,OAAO,EAAIW,CAC3E,CAAC,CACH,CACA,OAAQ,CACN,KAAK,SAAS,IAAIlB,CAAc,CAClC,CAEA,eAAkBmB,GAAa,CAC7B,KAAK,UAAUC,EAAa,eAAgBD,CAAQ,CACtD,EACA,cAAcA,EAAU,CACtB,KAAK,UAAUC,EAAa,cAAeD,CAAQ,CACrD,CACF"}