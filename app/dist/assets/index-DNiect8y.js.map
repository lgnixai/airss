{"version":3,"file":"index-DNiect8y.js","sources":["../../../esm/client/hooks/useBatchRef.js","../../../node_modules/.pnpm/react-use@17.5.1_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/react-use/esm/useLatest.js","../../../esm/client/components/collapse/style__variables.js","../../../esm/client/components/collapse/index.js","../../../esm/client/slots/explorer/index.js"],"sourcesContent":["import { useRef } from \"react\";\nfunction useBatchRef() {\n  const refs = useRef({});\n  function ref(key) {\n    return function(ref2) {\n      refs.current[key] = ref2;\n    };\n  }\n  ref.current = refs.current;\n  return ref;\n}\nexport {\n  useBatchRef as default\n};\n","import { useRef } from 'react';\nvar useLatest = function (value) {\n    var ref = useRef(value);\n    ref.current = value;\n    return ref;\n};\nexport default useLatest;\n","export default {\n  collapse: \"mo-collapse\",\n  item: \"mo-collapse__item\",\n  pane: \"mo-collapse__pane\",\n  header: \"mo-collapse__header\",\n  title: \"mo-collapse__title\",\n  content: \"mo-collapse__content\",\n  extra: \"mo-collapse__extra\",\n  headerSize:\"26px\",\n  transitionDelay:\"150\",\n}","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport { useEffect, useRef, useState } from \"react\";\nimport useLatest from \"react-use/esm/useLatest\";\nimport useMeasure from \"react-use/esm/useMeasure\";\nimport { classNames } from \"../../classNames\";\nimport { useBatchRef } from \"../../hooks\";\nimport { getNameForTitle, searchById } from \"../../../utils\";\nimport ActionBar from \"../actionBar\";\nimport Display from \"../display\";\nimport Flex from \"../flex\";\nimport Icon from \"../icon\";\nimport Prevent from \"../prevent\";\nimport Progress from \"../progress\";\nimport Split from \"../split\";\nimport \"./index.css\";\nimport variables from \"./style__variables.js\";\nconst HEADER_HEIGHT = parseInt(variables.headerSize, 10);\nfunction Collapse({\n  data = [],\n  activePanelKeys = [],\n  className,\n  title,\n  style,\n  role,\n  onCollapseChange,\n  onToolbarClick,\n  onContextMenu\n}) {\n  const contentRefs = useBatchRef();\n  const [ref, rect] = useMeasure();\n  const [sizes, setSizes] = useState(new Array(data.length).fill(HEADER_HEIGHT));\n  const timeout = useRef(0);\n  const activeKeysRef = useLatest(activePanelKeys);\n  const mutationObserver = useRef();\n  useEffect(() => {\n    mutationObserver.current = new MutationObserver((mutationList) => {\n      mutationList.forEach((mutation) => {\n        setHeightWithEle(mutation.target);\n      });\n    });\n    return () => {\n      mutationObserver.current?.disconnect();\n      window.clearTimeout(timeout.current);\n    };\n  }, []);\n  const watchEle = (id) => {\n    timeout.current = window.setTimeout(() => {\n      const ele = contentRefs.current[id]?.firstElementChild;\n      if (ele) {\n        mutationObserver.current?.observe(ele, {\n          childList: false,\n          attributes: true,\n          subtree: false,\n          attributeFilter: [\"style\"]\n        });\n        setHeightWithEle(ele);\n      }\n    }, 0);\n  };\n  const performSizes = () => {\n    const next = data.map((i) => i.hidden ? 0 : HEADER_HEIGHT);\n    const unExpanded = data.filter((item) => !activePanelKeys.includes(item.id) && !item.hidden);\n    let total = rect.height - unExpanded.length * HEADER_HEIGHT;\n    let pieces = 0;\n    const tmpGrow = [];\n    activePanelKeys.forEach((key) => {\n      const idx = data.findIndex(searchById(key));\n      const item = data[idx];\n      if (item.hidden)\n        return;\n      const grow = item.config?.grow;\n      if (grow === 0) {\n        const ele = contentRefs.current[item.id]?.firstElementChild;\n        const height = (ele?.getBoundingClientRect().height ?? 0) + HEADER_HEIGHT;\n        next[idx] = height;\n        total -= height;\n        watchEle(item.id);\n      } else {\n        pieces += grow ?? 1;\n        tmpGrow.push(idx);\n      }\n    });\n    const per = total / pieces;\n    tmpGrow.forEach((idx) => {\n      const item = data[idx];\n      const grow = item.config?.grow ?? 1;\n      next[idx] = per * grow;\n    });\n    setSizes(next);\n  };\n  useEffect(() => {\n    performSizes();\n  }, [data, activePanelKeys, rect.height]);\n  function setHeightWithEle(ele) {\n    if (ele) {\n      const parent = ele.parentElement;\n      const idx = data.findIndex((i) => i.id === parent.dataset.contentKey);\n      const height = ele.getBoundingClientRect().height;\n      setSizes((prev) => {\n        const diff = height + HEADER_HEIGHT - prev[idx];\n        prev[idx] = height + HEADER_HEIGHT;\n        const nextExpand = data.findIndex((i, index) => activeKeysRef.current.includes(i.id) && index > idx);\n        if (nextExpand === -1)\n          return [...prev];\n        prev[nextExpand] -= diff;\n        return [...prev];\n      });\n    }\n  }\n  const handleChangeCallback = (key) => {\n    const currentKeys = [...activePanelKeys];\n    if (currentKeys.includes(key)) {\n      const idx = currentKeys.indexOf(key);\n      currentKeys.splice(idx, 1);\n    } else {\n      currentKeys.push(key);\n    }\n    onCollapseChange?.(currentKeys);\n  };\n  const loading = rect.height === 0 || sizes.every((size) => size === 0);\n  return /* @__PURE__ */ jsxs(\"div\", { ref, className: classNames(variables.collapse, className), title, style, role, children: [\n    /* @__PURE__ */ jsx(Progress, { active: loading }),\n    /* @__PURE__ */ jsx(Split, { sizes, split: \"horizontal\", paneClassName: classNames(variables.pane), onChange: setSizes, children: data.map((panel, index) => {\n      const isActive = activePanelKeys.includes(panel.id);\n      const prevExpand = activePanelKeys.includes(data[index - 1]?.id);\n      const bothExpand = isActive && prevExpand;\n      const noneGrow = panel.config?.grow !== 0 && data[index - 1]?.config?.grow !== 0;\n      return /* @__PURE__ */ jsx(\n        Split.Pane,\n        {\n          minSize: HEADER_HEIGHT,\n          maxSize: isActive ? Infinity : HEADER_HEIGHT,\n          resizable: bothExpand && noneGrow,\n          hidden: panel.hidden,\n          children: /* @__PURE__ */ jsxs(\"div\", { className: classNames(variables.item, panel.className, isActive && variables.active), children: [\n            /* @__PURE__ */ jsx(Prevent, { onContextMenu: (e) => onContextMenu?.({ x: e.pageX, y: e.pageY }, panel), children: /* @__PURE__ */ jsxs(\n              Flex,\n              {\n                className: variables.header,\n                tabIndex: 0,\n                justifyContent: \"space-between\",\n                onClick: () => handleChangeCallback(panel.id),\n                children: [\n                  /* @__PURE__ */ jsxs(Flex, { title: panel.title || getNameForTitle(panel.name), children: [\n                    /* @__PURE__ */ jsx(Icon, { type: isActive ? \"chevron-down\" : \"chevron-right\" }),\n                    /* @__PURE__ */ jsx(\"span\", { className: variables.title, children: panel.name })\n                  ] }),\n                  isActive && /* @__PURE__ */ jsx(\n                    ActionBar,\n                    {\n                      className: variables.extra,\n                      data: panel.toolbar || [],\n                      onClick: (item) => onToolbarClick?.(item, panel.id)\n                    },\n                    panel.id\n                  )\n                ]\n              }\n            ) }),\n            /* @__PURE__ */ jsx(Display, { visible: isActive, delay: Number(variables.transitionDelay), children: /* @__PURE__ */ jsx(\n              \"div\",\n              {\n                className: variables.content,\n                tabIndex: 0,\n                ref: contentRefs(panel.id),\n                \"data-content-key\": panel.id,\n                children: panel.render?.(panel)\n              }\n            ) })\n          ] })\n        },\n        panel.id\n      );\n    }) })\n  ] });\n}\nexport {\n  HEADER_HEIGHT,\n  Collapse as default\n};\n","import { jsx } from \"react/jsx-runtime\";\nimport { Collapse } from \"../../components\";\nimport { useConnector } from \"../../hooks\";\nimport { sortByIndex } from \"../../../utils\";\nfunction Explorer({ onToolbarClick, onCollapseChange, onContextMenu }) {\n  const explorer = useConnector(\"explorer\");\n  const data = explorer.data.concat().sort(sortByIndex);\n  if (!data.length)\n    return null;\n  return /* @__PURE__ */ jsx(\n    Collapse,\n    {\n      data,\n      activePanelKeys: explorer.active,\n      onCollapseChange,\n      onToolbarClick,\n      onContextMenu\n    }\n  );\n}\nexport {\n  Explorer as default\n};\n"],"names":["useBatchRef","refs","useRef","ref","key","ref2","useLatest","value","variables","HEADER_HEIGHT","Collapse","data","activePanelKeys","className","title","style","role","onCollapseChange","onToolbarClick","onContextMenu","contentRefs","rect","useMeasure","sizes","setSizes","useState","timeout","activeKeysRef","mutationObserver","useEffect","mutationList","mutation","setHeightWithEle","watchEle","id","ele","performSizes","next","i","unExpanded","item","total","pieces","tmpGrow","idx","searchById","grow","height","per","parent","prev","diff","nextExpand","index","handleChangeCallback","currentKeys","loading","size","jsxs","classNames","jsx","Progress","Split","panel","isActive","prevExpand","bothExpand","noneGrow","Prevent","e","Flex","getNameForTitle","Icon","ActionBar","Display","Explorer","explorer","useConnector","sortByIndex"],"mappings":"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","x_google_ignoreList":[1]}