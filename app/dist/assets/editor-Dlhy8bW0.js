import{E as f,s as n,k as o,l,m as T,r as C,i as v}from"./index-Cz3doEcl.js";import{B as m}from"./baseService-IKxxVQs3.js";import{i as b}from"./isUndefined-DCTLXrZ8.js";import"./react-vendor-Bs7gn1Hv.js";import"./monaco-vendor-Dv-Uvxl1.js";var I=Object.getOwnPropertyDescriptor,E=(t,e,s,i)=>{for(var r=i>1?void 0:i?I(e,s):e,a=t.length-1,u;a>=0;a--)(u=t[a])&&(r=u(r)||r);return r};let p=class extends m{state;constructor(){super("editor"),this.state=new f}getToolbars(){return this.getState().toolbar}getCurrent(){return this.getState().current}getGroups(){return this.getState().groups}getToolbar(t){return this.getToolbars().find(n(t))}getGroup(t){if(!b(t))return this.getGroups().find(n(t))}getCurrentGroup(){return this.getGroup(this.getCurrent())}getTabs(t){return this.getGroup(t)?.data||[]}getCurrentTabs(){return this.getTabs(this.getCurrent())}getTab(t,e){if(!(b(e)||b(t)))return this.getTabs(e).find(n(t))}getCurrentTab(){return this.getTab(this.getCurrentGroup()?.activeTab,this.getCurrent())}getOptions(){return this.getState().options}updateOptions(t){this.dispatch(e=>{Object.assign(e.options,t)})}setOptions(t){this.dispatch(e=>{e.options=t})}setEntry(t){this.dispatch(e=>{e.entry=t})}updateTab(t,e){this.dispatch(s=>{const i=s.groups.find(n(e))?.data.find(n(t.id));i&&(Object.assign(i,t),Object.hasOwn(t,"value")&&(Array.isArray(t.value)?i.diffEditorModel&&(i.diffEditorModel.original.getValue()!==t.value[0]&&i.diffEditorModel.original.setValue(t.value[0]??""),i.diffEditorModel.modified.getValue()!==t.value[1]&&i.diffEditorModel.modified.setValue(t.value[1]??"")):i.model&&i.model.getValue()!==t.value&&i.model.setValue(t.value??"")),this.emit(o.onUpdateTab,t.id,e))})}saveTabs(t,e){t.forEach(s=>{this.updateTab({id:s,modified:!1},e)})}addToolbars(t){this.dispatch(e=>{e.toolbar.push(...t)})}updateToolbar(t){this.dispatch(e=>{const s=e.toolbar.find(n(t.id));s&&Object.assign(s,t)})}_close(t){this.dispatch(e=>{const s={tabId:this.getCurrentGroup()?.activeTab,groupId:e.current},i=[];t.forEach(({tabId:a,groupId:u})=>{const c=e.groups.findIndex(n(u)),d=e.groups[c],h=d.data.findIndex(n(a));if(h===-1)return;d.activeTab===a&&(d.activeTab=l(d.data,h)?.id);const[g]=d.data.splice(h,1);i.push(g)}),t.forEach(({groupId:a})=>{const u=e.groups.findIndex(n(a));if(u===-1||e.groups[u].data.length)return;e.current===a&&(e.current=l(e.groups,u)?.id);const[c]=e.groups.splice(u,1);c.editorInstance?.dispose()}),i.forEach(a=>{!a.model||e.groups.find(u=>u.data.find(c=>c.model===a.model))||a.model.dispose()}),this.emit(o.onClose,i);const r=e.groups.find(n(e.current))?.activeTab;(e.current!==s.groupId||r!==s.tabId)&&this.emit(o.onCurrentChange,s,{tabId:r,groupId:e.current})})}closeTab(t,e){this._close([{tabId:t,groupId:e}])}closeOther(t,e){const i=this.getTabs(e).filter(r=>r.id!==t);this._close(i.map(r=>({tabId:r.id,groupId:e})))}closeToRight(t,e){const s=this.getTabs(e),i=s.slice(s.findIndex(n(t))+1);this._close(i.map(r=>({tabId:r.id,groupId:e})))}closeToLeft(t,e){const s=this.getTabs(e),i=s.slice(0,s.findIndex(n(t)));this._close(i.map(r=>({tabId:r.id,groupId:e})))}closeSaved(t){const s=this.getTabs(t).filter(i=>!i.modified);this._close(s.map(i=>({tabId:i.id,groupId:t})))}removeGroup(t){const e=this.getGroup(t);e&&this._close(e.data.map(s=>({tabId:s.id,groupId:t})))}closeAll(t){if(b(t)){const e=this.getGroups();this._close(e.reduce((s,i)=>(s.push(...i.data.map(r=>({tabId:r.id,groupId:i.id}))),s),[]))}else this.removeGroup(t)}moveTab(t,e){this.dispatch(s=>{const i=s.groups.find(n(t.groupId)),r=s.groups.find(n(e.groupId));if(!i||!r)return;const a=i.data.findIndex(n(t.tabId)),u=r.data.findIndex(n(e.tabId));if(a===-1||u===-1)return;t.groupId!==e.groupId&&i.activeTab===t.tabId&&(i.activeTab=l(i.data,a)?.id);const c=i.data.splice(a,1),d=r.data.findIndex(n(t.tabId));if(d===-1?r.data.splice(u,0,c[0]):r.data.splice(u,0,r.data.splice(d,1)[0]),r.activeTab=t.tabId,!i.data.length){const h=s.groups.findIndex(n(t.groupId));s.groups.splice(h,1)}})}setCurrentGroup(t){const e=this.getCurrentGroup();this.emit(o.onCurrentChange,{tabId:e?.activeTab,groupId:e?.id},{tabId:this.getGroup(t)?.activeTab,groupId:t}),this.dispatch(s=>{s.current=t})}setCurrent(t,e){const s=this.getCurrentGroup();this.emit(o.onCurrentChange,{tabId:s?.activeTab,groupId:s?.id},{tabId:t,groupId:e}),this.dispatch(i=>{i.current=e;const r=i.groups.find(n(e));r&&(r.activeTab=t)})}updateGroup(t){if(Object.hasOwn(t,"activeTab")){const e=this.getCurrentGroup();this.emit(o.onCurrentChange,{tabId:e?.activeTab,groupId:e?.id},{tabId:t.activeTab,groupId:t.id})}this.dispatch(e=>{const s=e.groups.find(n(t.id));s&&Object.assign(s,t)})}setLoading(t){this.dispatch(e=>{e.loading=typeof t=="function"?t(e.loading):t})}createGroup(t){return{...new T(`EDITOR_GROUP_${C()}`,[t],t.id)}}addGroup(t){this.dispatch(e=>{e.groups.push(this.createGroup(t))})}addTab(t,e){this.dispatch(s=>{const i=s.groups.find(n(e));i&&i.data.push(t)})}open(t,e){if(this.getGroup(e))this.addTab(t,e),this.setCurrent(t.id,e);else{this.addGroup(t);const s=this.getGroups().at(-1);s&&this.setCurrentGroup(s.id)}this.emit(o.onOpenTab,t)}onFocus(t){this.subscribe(o.onFocus,t)}onCursorSelection(t){this.subscribe(o.onCursorSelection,t)}onSelectTab(t){this.subscribe(o.onSelectTab,t)}onContextMenu(t){this.subscribe(o.onContextMenu,t)}onToolbarClick(t){this.subscribe(o.onToolbarClick,t)}onUpdateTab(t){this.subscribe(o.onUpdateTab,t)}onOpenTab(t){this.subscribe(o.onOpenTab,t)}onChange(t){this.subscribe(o.onChange,t)}onDragStart(t){this.subscribe(o.onDragStart,t)}onDragEnd(t){this.subscribe(o.onDragEnd,t)}onDragEnter(t){this.subscribe(o.onDragEnter,t)}onDragLeave(t){this.subscribe(o.onDragLeave,t)}onDragOver(t){this.subscribe(o.onDragOver,t)}onDrop(t){this.subscribe(o.onDrop,t)}onClose(t){this.subscribe(o.onClose,t)}onCloseAll(t){this.subscribe(o.onCloseAll,t)}onCloseTab(t){this.subscribe(o.onCloseTab,t)}onCloseOther(t){this.subscribe(o.onCloseOther,t)}onCloseToLeft(t){this.subscribe(o.onCloseToLeft,t)}onCloseToRight(t){this.subscribe(o.onCloseToRight,t)}onSplitEditorRight(t){this.subscribe(o.onSplitEditorRight,t)}onContextMenuClick(t){this.subscribe(o.onContextMenuClick,t)}onMount(t){this.subscribe(o.onMount,t)}onModelMount(t){this.subscribe(o.onModelMount,t)}onDiffEditorMount(t){this.subscribe(o.onDiffEditorMount,t)}onDiffEditorModelMount(t){this.subscribe(o.onDiffEditorModelMount,t)}onCurrentChange(t){this.subscribe(o.onCurrentChange,t)}};p=E([v()],p);export{p as EditorService};
//# sourceMappingURL=editor-Dlhy8bW0.js.map
